# 🔒 資安檢查清單
# Security Checklist

## ✅ 已完成的資安改進

### 1. API 安全防護
- [x] **輸入驗證**: 實作 `sanitize_input()` 函數防止 XSS 攻擊
- [x] **長度限制**: 限制輸入長度為 500 字符
- [x] **字符過濾**: 只允許安全字符，移除潛在危險字符
- [x] **錯誤處理**: 實作完整的錯誤處理機制
- [x] **日誌記錄**: 記錄所有重要操作和錯誤

### 2. 速率限制
- [x] **每分鐘限制**: 60 次請求/分鐘
- [x] **每小時限制**: 1000 次請求/小時
- [x] **IP 追蹤**: 基於 IP 地址的速率限制
- [x] **429 狀態碼**: 正確的 HTTP 狀態碼回應

### 3. CORS 安全設定
- [x] **來源限制**: 只允許指定的域名
- [x] **方法限制**: 只允許 GET 和 POST
- [x] **標頭限制**: 只允許必要的標頭

### 4. CloudFormation 安全群組
- [x] **SSH 限制**: SSH 只允許私有網路 (10.0.0.0/8)
- [x] **HTTPS 支援**: 新增 443 端口支援
- [x] **描述標籤**: 為每個規則添加描述
- [x] **出站規則**: 明確設定出站流量規則

### 5. IAM 角色和權限
- [x] **EC2 角色**: 使用 IAM 角色而非硬編碼憑證
- [x] **最小權限**: 只授予必要的 S3 讀取權限
- [x] **CloudWatch**: 啟用 CloudWatch 監控

### 6. Docker 容器安全
- [x] **非 root 使用者**: 使用 appuser (UID 1000)
- [x] **權限設定**: 適當的檔案權限 (755/644)
- [x] **安全更新**: 安裝系統安全更新
- [x] **資源限制**: 記憶體和 CPU 限制
- [x] **健康檢查**: 改進的健康檢查機制

### 7. 環境變數安全
- [x] **敏感資料分離**: 建立生產環境配置範例
- [x] **密碼強度**: 要求強密碼設定
- [x] **配置指南**: 詳細的安全配置說明

## 🚨 部署前必須檢查

### 環境變數設定
- [ ] 確認 `ALLOWED_ORIGINS` 設定正確的域名
- [ ] 設定強密碼的 `SECRET_KEY` 和 `JWT_SECRET_KEY`
- [ ] 確認 `FLASK_DEBUG=False` 在生產環境
- [ ] 設定適當的速率限制參數

### AWS 設定
- [ ] 確認 EC2 實例使用 IAM 角色
- [ ] 檢查安全群組規則是否正確
- [ ] 確認 CloudFront 使用 HTTPS
- [ ] 設定適當的 S3 儲存桶政策

### 監控和日誌
- [ ] 啟用 CloudWatch 日誌
- [ ] 設定日誌輪轉
- [ ] 配置監控告警
- [ ] 測試錯誤處理機制

## 🔍 定期安全檢查

### 每週檢查
- [ ] 檢查系統更新
- [ ] 檢視日誌中的異常活動
- [ ] 確認速率限制正常運作

### 每月檢查
- [ ] 輪換密碼和 API 金鑰
- [ ] 檢查 IAM 權限
- [ ] 更新依賴套件
- [ ] 檢視安全群組規則

### 每季檢查
- [ ] 進行滲透測試
- [ ] 檢視 AWS 安全建議
- [ ] 更新安全政策
- [ ] 備份和災難恢復測試

## 📋 緊急應變程序

### 發現安全漏洞時
1. 立即隔離受影響的服務
2. 檢視日誌確定影響範圍
3. 修復漏洞並測試
4. 通知相關人員
5. 更新安全政策

### 遭受攻擊時
1. 立即停止服務
2. 保留日誌證據
3. 分析攻擊模式
4. 修復安全漏洞
5. 恢復服務並加強監控
